<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Intercom - Generate Token</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div id="app">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator">
                <div id="status-dot" class="status-dot"></div>
                <span id="status-text">Ready</span>
            </div>
        </div>

        <!-- Waiting Screen -->
        <!-- Initially flex so we see it immediately (though JS handles it too) -->
        <div id="waiting-screen" class="card" style="display: none;">
            <div class="pulse-ring"></div>
            <h2>Waiting for Connection</h2>
            <p>Share this token with the visitor:</p>

            <div class="token-display">
                <span class="token-label">Access Token</span>
                <h1 id="my-token">...</h1>
                <canvas id="qrcode" style="margin-top: 20px;"></canvas>
            </div>

            <p>Connecting automatically when joined...</p>
        </div>

        <!-- Main Call Interface -->
        <div id="main-interface" style="display: none;">
            <div class="video-container">
                <video id="remote-video" autoplay playsinline></video>
                <video id="local-video" autoplay playsinline muted></video>
            </div>

            <div class="controls">
                <!-- Mute Button -->
                <button id="mute-btn" class="control-btn icon-btn" disabled aria-label="Mute">
                    <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32"
                        fill="currentColor">
                        <path
                            d="M480-400q-50 0-85-35t-35-85v-240q0-50 35-85t85-35q50 0 85 35t35 85v240q0 50-35 85t-85 35Zm0-240Zm-40 520v-123q-104-14-172-93t-68-184h80q0 83 58.5 141.5T480-320q83 0 141.5-58.5T680-520h80q0 105-68 184t-172 93v123h-80Z" />
                    </svg>
                </button>

                <!-- Open Door Button -->
                <button id="open-door-btn" class="control-btn icon-btn success" disabled aria-label="Open Door">
                    <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32"
                        fill="currentColor">
                        <path
                            d="M280-400v-80h240v-80H280v-240h400v334q22 3 42 12t38 23v-449H200v480h80Zm200 320q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35Zm0-80q17 0 28.5-11.5T520-200q0-17-11.5-28.5T480-240q-17 0-28.5 11.5T440-200q0 17 11.5 28.5T480-160Zm-280 80v-160h160v160H200Zm380 0q51-90 145.5-125T880-160v80q-59 0-109.5 22.5T680-80h-80Z" />
                    </svg>
                </button>

                <!-- Hangup Button -->
                <button id="disconnect-btn" class="control-btn icon-btn danger" style="display: none;"
                    aria-label="End Call">
                    <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32"
                        fill="currentColor">
                        <path
                            d="M822-198 678-342l16-16q12-12 12-28t-12-28l-88-88q-12-12-28-12t-28 12l-72 72q-57-25-103-71t-70-102l72-72q12-12 12-28t-12-28l-88-88q-12-12-28-12t-28 12L130-488q-9 8-12.5 19t-.5 23q12 153 113.5 254.5T486-78q12 3 23-1t20-13l132-132 161 162q11 11 28 11t28-11q12-12 12-28t-12-28ZM396-608l-54 54q26 21 44 33t46 19l-36-106Zm166 166 106 36q-7-28-19-46t-33-44l-54 54Z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Incoming Call Modal (Technically not needed for Host but safe to keep structurally) -->
        <div id="incoming-call-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h2>Incoming Call</h2>
                <p><span id="caller-name-display">Guest</span> is calling...</p>
                <div class="modal-buttons">
                    <button id="answer-btn" class="modal-btn answer">Answer</button>
                    <button id="decline-btn" class="modal-btn decline">Decline</button>
                </div>
            </div>
        </div>

    </div>

    <script src="qrcode.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="/main.js?v=27"></script>
</body>

</html>